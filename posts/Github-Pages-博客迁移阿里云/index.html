<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Github Pages 博客迁移阿里云" /><meta name="author" content="李昊舒" /><meta property="og:locale" content="en_US" /><meta name="description" content="虽然没什么人看，但是还是想把博客搭建在自己服务器上，也算是锻炼锻炼动手能力（纯折腾），也给想要迁移的同学做一个简单的分享。" /><meta property="og:description" content="虽然没什么人看，但是还是想把博客搭建在自己服务器上，也算是锻炼锻炼动手能力（纯折腾），也给想要迁移的同学做一个简单的分享。" /><link rel="canonical" href="https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" /><meta property="og:url" content="https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" /><meta property="og:site_name" content="李昊舒的博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-09T18:15:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Github Pages 博客迁移阿里云" /><meta name="twitter:site" content="@magiclhs" /><meta name="twitter:creator" content="@李昊舒" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"李昊舒"},"description":"虽然没什么人看，但是还是想把博客搭建在自己服务器上，也算是锻炼锻炼动手能力（纯折腾），也给想要迁移的同学做一个简单的分享。","url":"https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/","@type":"BlogPosting","headline":"Github Pages 博客迁移阿里云","dateModified":"2021-02-09T18:15:00+08:00","datePublished":"2021-02-09T18:15:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/"},"@context":"https://schema.org"}</script><title>Github Pages 博客迁移阿里云 | 李昊舒的博客</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-TJL1M52M7E"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-TJL1M52M7E'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">李昊舒的博客</a></div><div class="site-subtitle font-italic">温润如玉</div></div><ul class="nav flex-column w-100"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>主页</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/lutianaicai" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/magiclhs" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.weibo.com/magiclhs" aria-label="" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-weibo"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['lihaoshu2046','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 主页 </a> </span> <span>Github Pages 博客迁移阿里云</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Github Pages 博客迁移阿里云</h1><div class="post-meta text-muted d-flex flex-column"><div> 由 <span class="author"> 李昊舒 </span> 发布于 <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Feb 9, 2021, 6:15 PM +0800" > 02-09 <i class="unloaded">2021-02-09T18:15:00+08:00</i> </span></div></div><div class="post-content"><p>虽然没什么人看，但是还是想把博客搭建在自己服务器上，也算是锻炼锻炼动手能力（纯折腾），也给想要迁移的同学做一个简单的分享。</p><h3 id="前期准备">前期准备</h3><h4 id="博客打包文件夹">博客打包文件夹</h4><p>我的博客使用 <a href="https://jekyllrb.com/">jekyll</a> 搭建</p><p>编译</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>jekyll build
</pre></table></code></div></div><p>项目中的 _site 目录就是编译后的博客</p><h4 id="服务器购买">服务器购买</h4><p>我选择了一台阿里云 CentOS 7.3 轻量应用服务器</p><h4 id="域名绑定">域名绑定</h4><p>购买一个喜欢的域名阿里云也有相应<a href="https://wanwang.aliyun.com/domain/">支持</a>, 然后进行服务器绑定。</p><h3 id="服务器配置">服务器配置</h3><h4 id="博客项目部署">博客项目部署</h4><p>把博客项目放入指定文件夹</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>scp -r _site文件夹本地目录 root@服务器公网ip:目标目录
</pre></table></code></div></div><h4 id="nginx-配置">nginx 配置</h4><p>使用 nginx 管理 Web 服务</p><p>安装</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum install nginx
</pre></table></code></div></div><p>打开配置文件</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /etc/nginx/nginx.conf
</pre></table></code></div></div><p>修改相应配置</p><ul><li>blog location 替换成刚才 scp 命令指定的目录也就是博客 _site 文件夹地址</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>server {
    listen       80 default_server;
    listen       [::]:80 default_server;
    server_name  _; 
    root         blog location;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
    location = /404.html {
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
    }
}
</pre></table></code></div></div><p>按 Esc 键、输入 :wq 并按 Enter 键，保存修改后的配置文件并退出编辑模式。</p><p>启动 nginx</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>systemctl start nginx
</pre></table></code></div></div><p>Tips: 我在这里有报错</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>&gt;&gt;&gt; service nginx restart
Job for nginx.service failed because the control process exited with error code.
See "systemctl status nginx.service" and "journalctl -xe" for details.
</pre></table></code></div></div><p>原因是阿里云服务器已经把 80 端口占用了</p><p>解除 80 端口占用</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>fuser -k 80/tcp
</pre></table></code></div></div><p>再次启动 nginx</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>systemctl start nginx
</pre></table></code></div></div><p>这个时候浏览器输入绑定的域名就可以访问博客了，不过这个时候迁移工作只能算是进行了一半。</p><h4 id="https">https</h4><p>域名旁边的 Not Secure 好刺眼，不能忍。</p><p>阿里云可以 <a href="https://help.aliyun.com/document_detail/156645.html">申请免费DV证书</a>。 根据流程提示下载证书文件</p><p>我的下好了是 xxx.key 和 xxx.pem 两个文件。如果是其他格式请<a href="https://help.aliyun.com/document_detail/42214.html">参考</a></p><p>再次打开 nginx 配置文件</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vi /etc/nginx/nginx.conf
</pre></table></code></div></div><ul><li>yourdomain.com：替换成证书绑定的域名。<li>cert-file-name.pem：替换成证书文件的名称。<li>cert-file-name.key：替换成证书密钥文件的名称。</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>server {
    listen       443 ssl http2 default_server;
    listen       [::]:443 ssl http2 default_server;
    server_name  yourdomain.com;
    root         blog location;

    ssl_certificate "cert-file-name.pem";
    ssl_certificate_key "cert-file-name.key";
    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout  10m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
    location = /404.html {
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
    }
}
</pre></table></code></div></div><p>设置 http 自动跳转 https</p><p>nginx 配置</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>server {
    listen 80;
    server_name yourdomain.com; #需要将yourdomain.com替换成证书绑定的域名。
    rewrite ^(.*)$ https://$host$1; #将所有HTTP请求通过rewrite指令重定向到HTTPS。
    location / {
        index index.html index.htm;
    }
}
</pre></table></code></div></div><p>更多细节请参考<a href="https://help.aliyun.com/document_detail/98728.html">在Nginx（或Tengine）服务器上安装证书</a></p><p>nginx 重新加载配置文件</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nginx -s reload
</pre></table></code></div></div><p>这下看着顺眼多了。</p><h3 id="自动部署">自动部署</h3><p>先给服务器开通下免密登陆，防止密码暴力破解，也方便后续自动部署的设置。已经免密的跳过此步骤。</p><h4 id="免密登陆">免密登陆</h4><h5 id="生成-ssh-公钥">生成 SSH 公钥</h5><p>检查本机器有无生成过密钥</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>cd ~/.ssh
ls
id_rsa      id_rsa.pub  known_hosts
</pre></table></code></div></div><p>如果有 id_rsa 和 id_rsa.pub 两个文件则生成过，<code class="language-plaintext highlighter-rouge">.pub</code> 扩展名的文件就是你的公钥。如果没有则需要生成。</p><p>生成密钥</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh-keygen
</pre></table></code></div></div><p>一路回车就可以</p><h5 id="本地公钥上传服务器">本地公钥上传服务器</h5><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh-copy-id -i ~/.ssh/id_rsa.pub root@公网ip
</pre></table></code></div></div><p>然后就可以免密登陆了</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh root@公网ip
</pre></table></code></div></div><h4 id="travis-ci-配置">Travis CI 配置</h4><p>自动部署我选择<a href="https://travis-ci.com/">Travis CI</a></p><h5 id="注册">注册</h5><p>选择 github 账号注册，添加自己的博客项目仓库，开启 Travis 监听</p><h5 id="配置-travisyml">配置 .travis.yml</h5><p>项目中添加一个 .travis.yml 文件，功能是告诉 Travis 需要做什么。</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>os: linux
dist: bionic

language: ruby
rvm: 2.7.0

cache: bundler

addons:
  // 服务器信任
  ssh_known_hosts: $server_ip
    
script:
  // 博客编译打包
  - JEKYLL_ENV=production bundle exec jekyll b

before_install:
  // 密钥加密储存自动生成
  - openssl aes-256-cbc -K $encrypted_2f88525daf9f_key -iv $encrypted_2f88525daf9f_iv
    -in id_rsa.enc -out ~/.ssh/id_rsa -d
  // 修改权限以防 warning
  - chmod 600 ~/.ssh/id_rsa
  
after_success:
  // 部署打包后文件夹 _site 到服务器
  - scp -o StrictHostKeyChecking=no -r "$SOURCE_PATH" "$server_user"@"$server_ip":"$BLOG_PATH"
</pre></table></code></div></div><p>服务器密钥加密这里说一下</p><p>先安装 travis</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gem install travis
</pre></table></code></div></div><p>然后登录 travis</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>travis login

We need your GitHub login to identify you.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Try running with --github-token or --auto if you don't want to enter your password anyway.
</pre></table></code></div></div><p>这里还是推荐 <a href="https://github.com/settings/tokens">github token</a> 方式登录</p><p>然后切换到博客项目目录下</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>travis encrypt-file ~/.ssh/id_rsa --add
</pre></table></code></div></div><p>这一步就是把之前免密登陆的私钥加密保存到了 travis .travis.yml 文件会自动生成</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>before_install:
  // 密钥加密储存自动生成
  - openssl aes-256-cbc -K $encrypted_2f88525daf9f_key -iv $encrypted_2f88525daf9f_iv
    -in id_rsa.enc -out ~\/.ssh/id_rsa -d
</pre></table></code></div></div><p>需要你提交到 github，提交前注意删除 <code class="language-plaintext highlighter-rouge">~\/.ssh/id_rsa -d</code> 的反斜杠</p><p>travis 项目 Settings 里也会多两个变量</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2021/travis-1.png" alt="" /></p><p>你也可以添加其他变量，在 .travis.yml 中直接 $变量名 进行引用。</p><p>最后，在 after_success: hook 里面执行 scp 命令就可以了</p><p>参数 <code class="language-plaintext highlighter-rouge">StrictHostKeyChecking=no</code> 要注意添加，否则报错。</p><p>更多细节<a href="https://docs.travis-ci.com/user/tutorial/">Travis官方文档</a></p><h3 id="结语">结语</h3><p>到这里，每次发文章前，本地检查无误之后，只需要提交项目，几分钟后服务器就会自动更新了。</p><p>干到这才算稍微有点模样。</p><p>这一套流程下来我也踩了不少坑，分享出来如果有错误还请大家不吝赐教。</p><p>一起加油～</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/'>技术杂谈</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nginx/" class="post-tag no-text-decoration" >nginx</a> <a href="/tags/travis/" class="post-tag no-text-decoration" >Travis</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/" class="post-tag no-text-decoration" >博客迁移</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-tag no-text-decoration" >服务器</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 该博客文章由作者通过 <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 进行授权。</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Github Pages 博客迁移阿里云 - 李昊舒的博客&url=https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Github Pages 博客迁移阿里云 - 李昊舒的博客&u=https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Github Pages 博客迁移阿里云 - 李昊舒的博客&url=https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Github Pages 博客迁移阿里云 - 李昊舒的博客&url=https://lutianaicai.github.io/posts/Github-Pages-%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E9%98%BF%E9%87%8C%E4%BA%91/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E5%9B%9B/">程序员的自我修养 ——链接、装载与库读书笔记（四）</a><li><a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%B8%80/">程序员的自我修养 ——链接、装载与库读书笔记（一）</a><li><a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%BA%8C/">程序员的自我修养 ——链接、装载与库读书笔记（二）</a><li><a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%B8%89/">程序员的自我修养 ——链接、装载与库读书笔记（三）</a><li><a href="/posts/Kingfisher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Kingfisher 源码分析</a></ul></div><div id="access-tags"> <span>热门标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5/">静态链接</a> <a class="post-tag" href="/tags/nginx/">nginx</a> <a class="post-tag" href="/tags/travis/">Travis</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5/">动态链接</a> <a class="post-tag" href="/tags/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/">博客迁移</a> <a class="post-tag" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a> <a class="post-tag" href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">年终总结</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a> <a class="post-tag" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">文章目录</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>接下来阅读</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E5%9B%9B/"><div class="card-body"> <span class="timeago small" > 04-15 <i class="unloaded">2021-04-15T16:26:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>程序员的自我修养 ——链接、装载与库读书笔记（四）</h3><div class="text-muted small"><p> 此系列为我学习经典的读书笔记，目的是理清知识脉络帮助理解记忆，内容深度、质量远远不及原书。如果您对相关知识感兴趣，强烈建议阅读原书程序员的自我修养 带着问题学习 为什么要动态链接 动态链接的关键结构有哪些 动态链接有哪些步骤 为什么要动态链接 静态链接使得不同开发者或部门之间能够按模块开发，这大大提高了生产效率，与此同时静态链接的两个缺点也显现出来。一个是占用...</p></div></div></a></div><div class="card"> <a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%B8%89/"><div class="card-body"> <span class="timeago small" > 03-31 <i class="unloaded">2021-03-31T19:12:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>程序员的自我修养 ——链接、装载与库读书笔记（三）</h3><div class="text-muted small"><p> 此系列为我学习经典的读书笔记，目的是理清知识脉络帮助理解记忆，内容深度、质量远远不及原书。如果您对相关知识感兴趣，强烈建议阅读原书程序员的自我修养 带着问题学习 静态链接中，输入的目标文件的各个段是如何被合并到输出文件的 链接器如何为他们分配在输出文件中的空间和地址 什么是 COMMON 块，未初始化的全局/静态变量为什么要使用它 空间与地址分配 对于链接器而...</p></div></div></a></div><div class="card"> <a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%BA%8C/"><div class="card-body"> <span class="timeago small" > 03-30 <i class="unloaded">2021-03-30T17:33:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>程序员的自我修养 ——链接、装载与库读书笔记（二）</h3><div class="text-muted small"><p> 此系列为我学习经典的读书笔记，目的是理清知识脉络帮助理解记忆，内容深度、质量远远不及原书。如果您对相关知识感兴趣，强烈建议阅读原书程序员的自我修养 带着问题学习 源代码到可执行文件都经历了哪些步骤 编译器做了什么工作 什么是静态链接，静态链接都包含哪些步骤 可执行文件的生成 源代码到可执行文件的生成可分为预处理（Prepressing）、编译（Compilat...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2020%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" class="btn btn-outline-primary"><p>2020 年终总结</p></a> <a href="/posts/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB-%E9%93%BE%E6%8E%A5-%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E4%B8%80/" class="btn btn-outline-primary"><p>程序员的自我修养 ——链接、装载与库读书笔记（一）</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="lutianaicai/lutianaicai.github.io" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/magiclhs">李昊舒</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，否则本网站上的博客文章均由作者根据知识共享许可协议 - 署名标示 4.0（CC BY 4.0）进行授权许可。">保留部分权利。</span> <a href="https://beian.miit.gov.cn/" target="_blank">冀 ICP 备 2021001127 号-1</a></p></div><div class="footer-right"><p class="mb-0"> 本博客由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，使用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> 作为主题</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">热门标签</h4><a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a> <a class="post-tag" href="/tags/%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5/">静态链接</a> <a class="post-tag" href="/tags/nginx/">nginx</a> <a class="post-tag" href="/tags/travis/">Travis</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5/">动态链接</a> <a class="post-tag" href="/tags/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/">博客迁移</a> <a class="post-tag" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a> <a class="post-tag" href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">年终总结</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a> <a class="post-tag" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://lutianaicai.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
